# The web application for the OpenMP microbenchmark analysis tool

To see how the application work, you can access http://www.openmpbench.xyz/ where our application is deployed.

## Structure
* **benchmark:** A created app directory used to process the request, do data processing and make response. The key message-processing functions are in "views.py".
* **common:*** A created app directory used to store the definitions of common database tables in "models.py".
* **config:** A directory that contains the key configuration files for the project.
* **dist:** This directory contains all the front-end files including HTML, CSS and JavaScript.
* **SQL_script_data_collection:** This contains SQL script exported from our database to directly generate our collected data on users' database table.
* **manage.py:** A tool script for project management, used to perform administrative operations.
* **run_gunicorn.sh:*** A shell script used to start Gunicorn in production environment.

The directory **"dist"** contains all the HTML, CSS and JS files that make up the font-end UI.

## Environment Requirements

There are some required packages to install:

```
pip3 install django
pip3 install PyMySQL
pip3 install django-redis
```

## Run on local machine (Development environment)

**Step 1:** Run the MySQL service (3306) and Redis service (6379) on the default ports.  

**Step 2:** Enter config/settings.py from the project root directory (the directory containing “manage.py”) to modify the DATABASE setting part (commented in the file), including filling in the selected local database name, the username and password required to log in to the target database.

**Step 3:** Run the following commands to create database tables required for our application:
```
python manage.py makemigrations common
python manage.py migrate
```
Then import the CSV file generated by our provided shell script into the created database table “common_benchmark” through Navicat or other MySQL management tool.  

**Step 4:** Enter "dist/js/js_base.js" from the project root directory to modify the displaying options for platforms and compilers based on the imported overhead data in Step 3. The file “js_base.js” includes instructions about how to modify at the beginning of the file.  
**Please note: The option names on the web page should be the same with the values in each field of the CSV file in Step 3.**

**Step 5:** Enter the project root directory and execute the following command to start the web service:
```
python manage.py runserver 0.0.0.0:80
```
0.0.0.0:80 is the IP address and port bound to the specified web service. 0.0.0.0 means to bind all the IP addresses of the local machine, which means we can access the service through any local IP (including the loopback address 127.0.0.1) while 80 means that the service is run on port 80.

**Step 6:** Open the browser and enter “127.0.0.1/index.html” in the address bar, then we can access the web service in the browser on local machine.


For the database section, the database table "common_benchmark" used for our current website is stored in the "SQL_script_data_collection" folder, which corresponds to all the options displayed in the current front-end UI code. Users can use the SQL script to generate the "common_benchmark" directly after creating the database tables using Django, so that users can run our website version and see the data we provide on local machine without the need to collect data themselves.

## Put the application into production environment on cloud server
If you want to put the application into production environment, you should install the following packages first.
```
pip3 install greenlet
pip3 install gevent    
pip3 install gunicorn
```

Then separate the static files from the back-end code. This is because using Nginx in the production environment forwards to different places according to the request. The static files are all in the **"dist"** folder, so you just need to move the folder to another path.

A Nginx configuration example is in "../Nginx_configuration". Based on the path of the front-end and your settings for the back-end, modify the Nginx configuration file.

To run the web service on a cloud server, we first need to start the Gunicorn by running the "run_gunicorn.sh" in the back-end directory:
```
$ bash run_gunicorn.sh
```

After starting the Gunicorn, you can use the ps command to see its PID:
```
$ ps -ef | grep Gunicorn
```

After starting Gunicorn and modifying the Nginx configuration file, use the following command to restart the Nginx service:
```
$ systemctl restart nginx
```


